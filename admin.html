<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricket Scheduler - Admin Panel</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            border-bottom: 2px solid #ddd;
        }
        .admin-tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
        }
        .admin-tab.active {
            color: #2e7d32;
            border-bottom: 3px solid #2e7d32;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .delete-btn {
            background: #d32f2f;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
            font-size: 12px;
        }
        .delete-btn:hover {
            background: #b71c1c;
        }
        .admin-item {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #2e7d32;
        }
        .admin-item small {
            color: #666;
            font-size: 11px;
        }
        .refresh-all-btn {
            background: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .refresh-all-btn:hover {
            background: #1565c0;
        }
    </style>
</head>
<body>
    <div id="admin-app">
        <header>
            <h1>üèè Cricket Scheduler - Admin Panel</h1>
            <button class="refresh-all-btn" onclick="loadAll()">üîÑ Refresh All</button>
        </header>

        <div class="admin-tabs">
            <button class="admin-tab active" onclick="switchTab('matches')">Matches</button>
            <button class="admin-tab" onclick="switchTab('users')">Users</button>
            <button class="admin-tab" onclick="switchTab('teams')">Teams</button>
            <button class="admin-tab" onclick="switchTab('availability')">Availability Posts</button>
        </div>

        <div class="admin-content">
            <!-- Matches Tab -->
            <div id="matches-tab" class="tab-content active">
                <div class="card">
                    <h3>All Matches</h3>
                    <div id="all-matches"></div>
                </div>
            </div>

            <!-- Users Tab -->
            <div id="users-tab" class="tab-content">
                <div class="card">
                    <h3>All Users</h3>
                    <div id="all-users"></div>
                </div>
            </div>

            <!-- Teams Tab -->
            <div id="teams-tab" class="tab-content">
                <div class="card">
                    <h3>All Teams</h3>
                    <div id="all-teams"></div>
                </div>
            </div>

            <!-- Availability Tab -->
            <div id="availability-tab" class="tab-content">
                <div class="card">
                    <h3>All Availability Posts</h3>
                    <div id="all-availability"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:3000'
            : 'https://cricket-matches-scheduler.onrender.com';

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.admin-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        function loadAll() {
            loadAllMatches();
            loadAllUsers();
            loadAllTeams();
            loadAllAvailability();
        }

        // Matches
        async function loadAllMatches() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/matches`);
                const matches = await response.json();
                renderAllMatches(matches);
            } catch (error) {
                console.error('Failed to load matches', error);
            }
        }

        function renderAllMatches(matches) {
            const container = document.getElementById('all-matches');
            if (matches.length === 0) {
                container.innerHTML = '<p>No matches found.</p>';
                return;
            }

            container.innerHTML = matches.map(match => `
                <div class="admin-item">
                    <strong>${match.team1_name || 'Unknown'} vs ${match.team2_name || 'Unknown'}</strong>
                    <button class="delete-btn" onclick="deleteMatch('${match.id}')">üóëÔ∏è Delete</button>
                    <br><small>ID: ${match.id}</small>
                    <br>Captains: ${match.captain1_name || 'Unknown'} vs ${match.captain2_name || 'Unknown'}
                    <br>Day: ${match.day} | Bet: ‚Çπ${match.bet_amount}
                    ${match.ground ? `<br>Ground: ${match.ground}` : ''}
                    <br>Status: <strong>${match.status.toUpperCase()}</strong>
                    <br>Created: ${new Date(match.created_at).toLocaleString()}
                    ${match.captain1_confirmed ? '<br>‚úÖ Captain 1 Confirmed' : '<br>‚è≥ Captain 1 Pending'}
                    ${match.captain2_confirmed ? '<br>‚úÖ Captain 2 Confirmed' : '<br>‚è≥ Captain 2 Pending'}
                </div>
            `).join('');
        }

        async function deleteMatch(id) {
            if (!confirm('Are you sure you want to delete this match?')) return;
            try {
                const response = await fetch(`${API_BASE}/api/admin/match/${id}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                if (result.success) {
                    alert('Match deleted successfully!');
                    loadAllMatches();
                }
            } catch (error) {
                alert('Failed to delete match');
            }
        }

        // Users
        async function loadAllUsers() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/users`);
                const users = await response.json();
                renderAllUsers(users);
            } catch (error) {
                console.error('Failed to load users', error);
            }
        }

        function renderAllUsers(users) {
            const container = document.getElementById('all-users');
            if (users.length === 0) {
                container.innerHTML = '<p>No users found.</p>';
                return;
            }

            container.innerHTML = users.map(user => `
                <div class="admin-item">
                    <strong>${user.name}</strong>
                    <button class="delete-btn" onclick="deleteUser('${user.id}')">üóëÔ∏è Delete</button>
                    <br><small>ID: ${user.id}</small>
                    <br>Phone: ${user.phone}
                    <br>Role: ${user.role}
                    <br>Created: ${new Date(user.created_at).toLocaleString()}
                </div>
            `).join('');
        }

        async function deleteUser(id) {
            if (!confirm('Are you sure you want to delete this user? This will also affect their teams!')) return;
            try {
                const response = await fetch(`${API_BASE}/api/admin/user/${id}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                if (result.success) {
                    alert('User deleted successfully!');
                    loadAllUsers();
                }
            } catch (error) {
                alert('Failed to delete user');
            }
        }

        // Teams
        async function loadAllTeams() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/teams`);
                const teams = await response.json();
                renderAllTeams(teams);
            } catch (error) {
                console.error('Failed to load teams', error);
            }
        }

        function renderAllTeams(teams) {
            const container = document.getElementById('all-teams');
            if (teams.length === 0) {
                container.innerHTML = '<p>No teams found.</p>';
                return;
            }

            container.innerHTML = teams.map(team => `
                <div class="admin-item">
                    <strong>${team.team_name}</strong>
                    <button class="delete-btn" onclick="deleteTeam('${team.id}')">üóëÔ∏è Delete</button>
                    <br><small>ID: ${team.id}</small>
                    <br>Captain: ${team.captain_name || 'Unknown'} (${team.captain_phone || 'N/A'})
                    <br>Ground: ${team.ground}
                    <br>Members: ${team.members?.length || 0}
                    <br>Created: ${new Date(team.created_at).toLocaleString()}
                </div>
            `).join('');
        }

        async function deleteTeam(id) {
            if (!confirm('Are you sure you want to delete this team?')) return;
            try {
                const response = await fetch(`${API_BASE}/api/admin/team/${id}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                if (result.success) {
                    alert('Team deleted successfully!');
                    loadAllTeams();
                }
            } catch (error) {
                alert('Failed to delete team');
            }
        }

        // Availability Posts
        async function loadAllAvailability() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/availability`);
                const posts = await response.json();
                renderAllAvailability(posts);
            } catch (error) {
                console.error('Failed to load availability posts', error);
            }
        }

        function renderAllAvailability(posts) {
            const container = document.getElementById('all-availability');
            if (posts.length === 0) {
                container.innerHTML = '<p>No availability posts found.</p>';
                return;
            }

            container.innerHTML = posts.map(post => `
                <div class="admin-item">
                    <strong>${post.team_name || 'Unknown Team'} - ${post.day}</strong>
                    <button class="delete-btn" onclick="deleteAvailability('${post.id}')">üóëÔ∏è Delete</button>
                    <br><small>ID: ${post.id}</small>
                    <br>Captain: ${post.captain_name || 'Unknown'}
                    <br>Date: ${post.date ? new Date(post.date).toLocaleDateString() : 'Not specified'}
                    <br>Bet: ‚Çπ${post.bet_amount}
                    <br>Ground: ${post.ground} (${post.ground_type || 'free'})
                    ${post.time_slot ? `<br>Time Slot: ${post.time_slot}` : ''}
                    <br>Status: <strong>${post.status.toUpperCase()}</strong>
                    <br>Created: ${new Date(post.created_at).toLocaleString()}
                </div>
            `).join('');
        }

        async function deleteAvailability(id) {
            if (!confirm('Are you sure you want to delete this availability post?')) return;
            try {
                const response = await fetch(`${API_BASE}/api/admin/availability/${id}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                if (result.success) {
                    alert('Availability post deleted successfully!');
                    loadAllAvailability();
                }
            } catch (error) {
                alert('Failed to delete availability post');
            }
        }

        // Load all data on page load
        loadAll();
    </script>
</body>
</html>